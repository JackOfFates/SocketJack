<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocketClient Chat Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #log { width: 100%; height: 300px; margin-bottom: 10px; }
        #inputBox { width: 80%; }
        #sendBtn { width: 18%; }
    </style>
</head>
<body>
    <h2>WebSocketClient Chat Demo</h2>
    <textarea id="log" readonly></textarea><br>
    <input type="text" id="inputBox" placeholder="Type your message...">
    <button id="sendBtn">Send</button>
    <br><br>
    <label>WebSocket URL: <input type="text" id="wsUrl" value="ws://localhost:8096/"></label>
    <button id="connectBtn">Connect</button>

    <script src="WebSocketClient.js"></script>
    <script>
        class TextObject {
            constructor(text) {
                this.Text = text;
                this.Sender = "HtmlWebSocketClient";
            }
        }

        // UI logic
        const logBox = document.getElementById('log');
        const inputBox = document.getElementById('inputBox');
        const sendBtn = document.getElementById('sendBtn');
        const connectBtn = document.getElementById('connectBtn');
        const wsUrl = document.getElementById('wsUrl');
        let client = null;

        function log(text) {
            logBox.value += text + "\n";
            logBox.scrollTop = logBox.scrollHeight;
        }

        connectBtn.onclick = async function () {
            if (client && client.connected) {
                log("Already connected.");
                return;
            }
            client = new WebSocketClient("DemoClient");
            client.on('connected', () => { client.send(new TextObject("Test")); log("[Connected]"); });
            client.on('disconnected', () => log("[Disconnected]"));
            client.on('error', err => log("[Error] " + err));
            client.on('sent', obj => log("[Sent] " + (obj.text || JSON.stringify(obj))));
            client.on('receive', obj => {
                if (obj.type === "TextObject") {
                    log("[Received] " + obj.Sender + ": " + obj.Text);
                } else {
                    //log("[Received] " + JSON.stringify(obj));
                }
            });
            log("Connecting to " + wsUrl.value + " ...");
            try {
                await client.connect(wsUrl.value);
            } catch (e) {
                log("Connection failed: " + e);
            }
        };

        function sendChat() {
            if (!client || !client.connected) {
                log("Not connected.");
                return;
            }
            var text = inputBox.value.trim();
            if (!text) return;
            client.send(new TextObject(text));
            inputBox.value = "";
        }

        sendBtn.onclick = sendChat;
        inputBox.onkeydown = function (e) {
            if (e.key === "Enter") {
                sendChat();
                e.preventDefault();
            }
        };
    </script>
</body>
</html>
